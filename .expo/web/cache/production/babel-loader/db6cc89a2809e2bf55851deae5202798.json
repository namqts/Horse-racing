{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _objectWithoutProperties from\"@babel/runtime/helpers/objectWithoutProperties\";var _excluded=[\"onOpen\",\"trigger\",\"onClose\",\"isOpen\",\"children\",\"defaultIsOpen\",\"initialFocusRef\",\"finalFocusRef\",\"useRNModal\",\"trapFocus\"];function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends.apply(this,arguments);}import React,{forwardRef,memo}from'react';import{Popper}from\"../Popper\";import{mergeRefs}from\"../../../utils\";import{useControllableState}from\"../../../hooks\";import{PopoverContext}from\"./PopoverContext\";import Box from\"../../primitives/Box\";import Backdrop from\"../Backdrop\";import{FocusScope}from'@react-native-aria/focus';import{PresenceTransition}from\"../Transitions\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import{useId}from'@react-native-aria/utils';import{Overlay}from\"../../primitives/Overlay\";import{useHasResponsiveProps}from\"../../../hooks/useHasResponsiveProps\";import{uniqueId}from'lodash';import{ResponsiveQueryContext}from\"../../../utils/useResponsiveQuery/ResponsiveQueryProvider\";var Popover=function Popover(_ref,ref){var onOpen=_ref.onOpen,trigger=_ref.trigger,onClose=_ref.onClose,isOpenProp=_ref.isOpen,children=_ref.children,defaultIsOpen=_ref.defaultIsOpen,initialFocusRef=_ref.initialFocusRef,finalFocusRef=_ref.finalFocusRef,useRNModal=_ref.useRNModal,_ref$trapFocus=_ref.trapFocus,trapFocus=_ref$trapFocus===void 0?true:_ref$trapFocus,props=_objectWithoutProperties(_ref,_excluded);var triggerRef=React.useRef(null);var mergedRef=mergeRefs([triggerRef]);var _useControllableState=useControllableState({value:isOpenProp,defaultValue:defaultIsOpen,onChange:function onChange(value){value?onOpen&&onOpen():onClose&&onClose();}}),_useControllableState2=_slicedToArray(_useControllableState,2),isOpen=_useControllableState2[0],setIsOpen=_useControllableState2[1];var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),bodyMounted=_React$useState2[0],setBodyMounted=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),headerMounted=_React$useState4[0],setHeaderMounted=_React$useState4[1];var id=uniqueId();var responsiveQueryContext=React.useContext(ResponsiveQueryContext);var disableCSSMediaQueries=responsiveQueryContext.disableCSSMediaQueries;if(!disableCSSMediaQueries){id=useId();}var popoverContentId=\"\".concat(id,\"-content\");var headerId=\"\".concat(popoverContentId,\"-header\");var bodyId=\"\".concat(popoverContentId,\"-body\");var handleOpen=React.useCallback(function(){setIsOpen(true);},[setIsOpen]);var updatedTrigger=function updatedTrigger(){return trigger({'ref':mergedRef,'onPress':handleOpen,'aria-expanded':isOpen?true:false,'aria-controls':isOpen?popoverContentId:undefined,'aria-haspopup':true},{open:isOpen});};var handleClose=function handleClose(){setIsOpen(false);};if(useHasResponsiveProps(props)){return null;}return React.createElement(Box,{ref:ref},updatedTrigger(),React.createElement(Overlay,{isOpen:isOpen,onRequestClose:handleClose,useRNModalOnAndroid:true,useRNModal:useRNModal,unmountOnExit:true},React.createElement(PresenceTransition,{initial:{opacity:0},animate:{opacity:1,transition:{duration:150}},exit:{opacity:0,scale:0.95,transition:{duration:100}},visible:isOpen,style:StyleSheet.absoluteFill},React.createElement(Popper,_extends({onClose:handleClose,triggerRef:triggerRef},props),React.createElement(Backdrop,{onPress:handleClose,bg:\"transparent\"}),React.createElement(PopoverContext.Provider,{value:{onClose:handleClose,initialFocusRef:initialFocusRef,finalFocusRef:finalFocusRef,popoverContentId:popoverContentId,bodyId:bodyId,headerId:headerId,headerMounted:headerMounted,bodyMounted:bodyMounted,setBodyMounted:setBodyMounted,setHeaderMounted:setHeaderMounted,isOpen:isOpen}},React.createElement(FocusScope,{contain:trapFocus,restoreFocus:true,autoFocus:true},children))))));};export default memo(forwardRef(Popover));","map":{"version":3,"sources":["Popover.tsx"],"names":["React","forwardRef","memo","Popper","mergeRefs","useControllableState","PopoverContext","Box","Backdrop","FocusScope","PresenceTransition","useId","Overlay","useHasResponsiveProps","uniqueId","ResponsiveQueryContext","Popover","onOpen","trigger","onClose","isOpen","isOpenProp","children","defaultIsOpen","initialFocusRef","finalFocusRef","useRNModal","trapFocus","props","ref","triggerRef","useRef","mergedRef","setIsOpen","value","defaultValue","onChange","bodyMounted","setBodyMounted","useState","headerMounted","setHeaderMounted","id","responsiveQueryContext","useContext","disableCSSMediaQueries","popoverContentId","headerId","bodyId","handleOpen","useCallback","updatedTrigger","undefined","open","handleClose","opacity","transition","duration","scale","StyleSheet","absoluteFill"],"mappings":"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","sourcesContent":["import React, { forwardRef, memo } from 'react';\nimport { Popper } from '../Popper';\nimport type { IPopoverProps } from './types';\nimport { mergeRefs } from '../../../utils';\nimport { useControllableState } from '../../../hooks';\nimport { PopoverContext } from './PopoverContext';\nimport Box from '../../primitives/Box';\nimport Backdrop from '../Backdrop';\nimport { FocusScope } from '@react-native-aria/focus';\nimport { PresenceTransition } from '../Transitions';\nimport { StyleSheet } from 'react-native';\nimport { useId } from '@react-native-aria/utils';\nimport { Overlay } from '../../primitives/Overlay';\nimport { useHasResponsiveProps } from '../../../hooks/useHasResponsiveProps';\nimport { uniqueId } from 'lodash';\nimport { ResponsiveQueryContext } from '../../../utils/useResponsiveQuery/ResponsiveQueryProvider';\n\nconst Popover = (\n  {\n    onOpen,\n    trigger,\n    onClose,\n    isOpen: isOpenProp,\n    children,\n    defaultIsOpen,\n    initialFocusRef,\n    finalFocusRef,\n    useRNModal,\n    trapFocus = true,\n    ...props\n  }: IPopoverProps,\n  ref: any\n) => {\n  const triggerRef = React.useRef(null);\n  const mergedRef = mergeRefs([triggerRef]);\n  const [isOpen, setIsOpen] = useControllableState({\n    value: isOpenProp,\n    defaultValue: defaultIsOpen,\n    onChange: (value) => {\n      value ? onOpen && onOpen() : onClose && onClose();\n    },\n  });\n\n  const [bodyMounted, setBodyMounted] = React.useState(false);\n  const [headerMounted, setHeaderMounted] = React.useState(false);\n  let id = uniqueId();\n  const responsiveQueryContext = React.useContext(ResponsiveQueryContext);\n  const disableCSSMediaQueries = responsiveQueryContext.disableCSSMediaQueries;\n\n  if (!disableCSSMediaQueries) {\n    // This if statement technically breaks the rules of hooks, but is safe\n    // because the condition never changes after mounting.\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    id = useId();\n  }\n\n  const popoverContentId = `${id}-content`;\n  const headerId = `${popoverContentId}-header`;\n  const bodyId = `${popoverContentId}-body`;\n\n  const handleOpen = React.useCallback(() => {\n    setIsOpen(true);\n  }, [setIsOpen]);\n\n  const updatedTrigger = () => {\n    return trigger(\n      {\n        'ref': mergedRef,\n        'onPress': handleOpen,\n        'aria-expanded': isOpen ? true : false,\n        'aria-controls': isOpen ? popoverContentId : undefined,\n        'aria-haspopup': true,\n      },\n      { open: isOpen }\n    );\n  };\n\n  const handleClose = () => {\n    setIsOpen(false);\n  };\n  //TODO: refactor for responsive prop\n  if (useHasResponsiveProps(props)) {\n    return null;\n  }\n\n  return (\n    <Box ref={ref}>\n      {updatedTrigger()}\n      <Overlay\n        isOpen={isOpen}\n        onRequestClose={handleClose}\n        useRNModalOnAndroid\n        useRNModal={useRNModal}\n        unmountOnExit\n      >\n        <PresenceTransition\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1, transition: { duration: 150 } }}\n          exit={{ opacity: 0, scale: 0.95, transition: { duration: 100 } }}\n          visible={isOpen}\n          style={StyleSheet.absoluteFill}\n        >\n          <Popper onClose={handleClose} triggerRef={triggerRef} {...props}>\n            <Backdrop onPress={handleClose} bg=\"transparent\" />\n            <PopoverContext.Provider\n              value={{\n                onClose: handleClose,\n                initialFocusRef,\n                finalFocusRef,\n                popoverContentId,\n                bodyId,\n                headerId,\n                headerMounted,\n                bodyMounted,\n                setBodyMounted,\n                setHeaderMounted,\n                isOpen,\n              }}\n            >\n              <FocusScope contain={trapFocus} restoreFocus autoFocus>\n                {children}\n              </FocusScope>\n            </PopoverContext.Provider>\n          </Popper>\n        </PresenceTransition>\n      </Overlay>\n    </Box>\n  );\n};\n\nexport default memo(forwardRef(Popover));\n"]},"metadata":{},"sourceType":"module"}